<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge View - Shatalov Graph</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <!-- Vis.js Network -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

    <style>
        [x-cloak] { display: none !important; }
        .vis-network { outline: none; }
        .card-masonry {
            column-count: 1;
        }
        @media (min-width: 768px) { .card-masonry { column-count: 2; } }
        @media (min-width: 1280px) { .card-masonry { column-count: 3; } }
        
        .shatalov-block {
            break-inside: avoid;
            page-break-inside: avoid;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden" x-data="app()">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between shadow-sm z-10">
        <div>
            <h1 class="text-xl font-bold text-slate-900 tracking-tight" x-text="meta.course_title || 'Knowledge Base'"></h1>
            <p class="text-sm text-slate-500" x-text="(meta.domain || 'General') + ' • ' + (concepts.length) + ' concept nodes'"></p>
        </div>
        
        <div class="flex items-center gap-4">
            <!-- Search -->
            <div class="relative">
                <input 
                    type="text" 
                    placeholder="Search concepts..." 
                    class="pl-9 pr-4 py-2 bg-slate-100 border-none rounded-lg text-sm focus:ring-2 focus:ring-blue-500 w-64 transition-all"
                    x-model="searchQuery"
                    @input.debounce.300ms="filterGraph()"
                >
                <svg class="w-4 h-4 text-slate-400 absolute left-3 top-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>

            <!-- View Toggle -->
            <div class="bg-slate-100 p-1 rounded-lg flex text-sm font-medium">
                <button 
                    @click="view = 'graph'" 
                    :class="view === 'graph' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'"
                    class="px-4 py-1.5 rounded-md transition-all">
                    Graph
                </button>
                <button 
                    @click="view = 'cards'" 
                    :class="view === 'cards' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'"
                    class="px-4 py-1.5 rounded-md transition-all">
                    Cards
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 relative overflow-hidden">
        
        <!-- Graph View -->
        <div x-show="view === 'graph'" class="absolute inset-0 bg-slate-50" x-transition.opacity>
            <div id="mynetwork" class="w-full h-full"></div>
            
            <!-- Floating Details Panel -->
            <div x-show="selectedNode" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="translate-x-full opacity-0"
                 x-transition:enter-end="translate-x-0 opacity-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="translate-x-0 opacity-100"
                 x-transition:leave-end="translate-x-full opacity-0"
                 class="absolute right-0 top-0 bottom-0 w-96 bg-white border-l border-slate-200 shadow-xl overflow-y-auto p-6 z-20"
                 x-cloak>
                
                <div class="flex justify-between items-start mb-4">
                    <span 
                        class="px-2 py-1 rounded text-xs font-semibold uppercase tracking-wider"
                        :class="typeColors[selectedNode?.type] || 'bg-slate-100 text-slate-600'"
                        x-text="selectedNode?.type">
                    </span>
                    <button @click="deselectNode()" class="text-slate-400 hover:text-slate-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <h2 class="text-2xl font-bold text-slate-900 mb-2" x-text="selectedNode?.label"></h2>
                
                <div x-show="selectedNode?.def" class="text-slate-600 mb-6 leading-relaxed" x-text="selectedNode?.def"></div>

                <!-- Related Skeleton Cards -->
                <template x-if="selectedNode?.cards.length > 0">
                    <div class="mb-6">
                        <h3 class="text-sm font-bold text-slate-900 uppercase tracking-widest mb-3">Found in Cards</h3>
                        <div class="space-y-2">
                            <template x-for="cardId in selectedNode.cards">
                                <button 
                                    @click="selectCard(cardId); view = 'cards'"
                                    class="w-full text-left px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded text-sm transition-colors flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                                    <span x-text="getCardTitle(cardId)"></span>
                                </button>
                            </template>
                        </div>
                    </div>
                </template>

                <!-- Relations -->
                <div x-show="selectedNode?.relations.length > 0">
                    <h3 class="text-sm font-bold text-slate-900 uppercase tracking-widest mb-3">Direct Links</h3>
                    <ul class="space-y-3">
                        <template x-for="rel in selectedNode.relations">
                            <li class="flex items-start gap-2 text-sm">
                                <span class="text-slate-400 mt-0.5">•</span>
                                <div>
                                    <span class="font-medium text-slate-700" x-text="rel.type.replace('_', ' ')"></span>
                                    <span class="text-slate-400 px-1">→</span>
                                    <button @click="focusNode(rel.targetId)" class="text-blue-600 hover:underline" x-text="rel.targetLabel"></button>
                                </div>
                            </li>
                        </template>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Cards View -->
        <div x-show="view === 'cards'" class="absolute inset-0 bg-slate-100 overflow-y-auto p-6" x-transition.opacity>
            <div class="max-w-7xl mx-auto card-masonry gap-6 space-y-6">
                
                <template x-for="card in skeleton_cards" :key="card.card_id">
                    <div 
                        :id="'card-' + card.card_id"
                        class="shatalov-block bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-md transition-shadow duration-200"
                        :class="{'ring-2 ring-blue-500': highlightedCard === card.card_id}">
                        
                        <!-- Header -->
                        <div class="bg-slate-50 border-b border-slate-100 px-5 py-4">
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-lg text-slate-800" x-text="card.topic"></h3>
                                <span class="text-xs font-mono text-slate-400" x-text="card.blocks.length + ' blocks'"></span>
                            </div>
                        </div>

                        <!-- Blocks -->
                        <div class="divide-y divide-slate-100">
                            <template x-for="(block, idx) in card.blocks" :key="block.block_id">
                                <div class="px-5 py-4 group hover:bg-slate-50 transition-colors">
                                    <div class="flex items-baseline justify-between mb-2">
                                        <h4 class="text-sm font-bold text-slate-700 uppercase tracking-wide" x-text="'Block ' + (idx+1) + ': ' + block.title"></h4>
                                    </div>

                                    <!-- Anchors -->
                                    <div class="flex flex-wrap gap-2 mb-3">
                                        <template x-for="anchor in block.anchors">
                                            <span 
                                                class="px-2.5 py-1 bg-indigo-50 text-indigo-700 border border-indigo-100 rounded text-sm font-medium"
                                                x-text="anchor">
                                            </span>
                                        </template>
                                    </div>

                                    <!-- Seeds Expansion -->
                                    <div x-data="{ expanded: false }">
                                        <button 
                                            @click="expanded = !expanded"
                                            class="text-xs text-slate-400 hover:text-blue-600 flex items-center gap-1 transition-colors">
                                            <span x-text="expanded ? 'Hide Details' : 'Show Details'"></span>
                                            <svg class="w-3 h-3 transition-transform" :class="expanded ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>

                                        <div x-show="expanded" x-collapse class="mt-3 space-y-2 text-sm text-slate-600 pl-3 border-l-2 border-slate-200">
                                            <template x-if="block.seed_pack.rule_plus_conditions">
                                                <p><strong class="text-slate-800">Rule:</strong> <span x-text="block.seed_pack.rule_plus_conditions"></span></p>
                                            </template>
                                            
                                            <template x-if="block.seed_pack.one_strong_example">
                                                <p><strong class="text-slate-800">Ex:</strong> <span x-text="block.seed_pack.one_strong_example"></span></p>
                                            </template>
                                            
                                            <template x-if="block.seed_pack.one_common_mistake">
                                                <div class="flex gap-2 text-amber-700 bg-amber-50 p-2 rounded items-start mt-2">
                                                    <svg class="w-4 h-4 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                                                    <span x-text="block.seed_pack.one_common_mistake"></span>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>

            </div>
        </div>

    </main>

    <!-- Data Injection Script -->
    <script>
        // Placeholder - will be replaced by Python script
        const DATA = {"meta": {"course_title": "Workplace Software and Skills", "chapter_title": "Preface", "domain": "education", "language": "en", "compression_notes": "Merged from 3 chunks. Total: 14 unique concepts, 16 meaning units, 3 skeleton cards."}, "meaning_units": [{"unit_id": "U1", "type": "definition", "source_span": {"start_char": 0, "end_char": 100}, "summary": "OpenStax is a nonprofit initiative providing free, peer-reviewed textbooks.", "key_terms": ["OpenStax", "nonprofit", "textbooks"], "symbols": [], "concept_refs": ["C1"], "relations": [], "seeds": {"rule_or_core": "OpenStax := nonprofit educational initiative", "conditions": [], "steps": [], "example": null, "mistake_and_fix": null}}, {"unit_id": "U2", "type": "claim_theorem", "source_span": {"start_char": 100, "end_char": 200}, "summary": "OpenStax aims to improve educational access through partnerships.", "key_terms": ["educational access", "partnerships"], "symbols": [], "concept_refs": ["C1"], "relations": [{"rel": "causes", "from": "C1", "to": "C2", "evidence": "improve educational access", "confidence": 1.0}], "seeds": {"rule_or_core": "If OpenStax partners, then educational access improves.", "conditions": [], "steps": [], "example": null, "mistake_and_fix": null}}, {"unit_id": "U3", "type": "method_procedure", "source_span": {"start_char": 200, "end_char": 300}, "summary": "Customization of OpenStax textbooks is allowed under CC BY license.", "key_terms": ["customization", "CC BY license"], "symbols": [], "concept_refs": ["C3"], "relations": [], "seeds": {"rule_or_core": "Customization := allowed under CC BY license", "conditions": ["attribution required"], "steps": ["distribute", "remix", "build upon"], "example": null, "mistake_and_fix": null}}, {"unit_id": "U4", "type": "warning_common_mistake", "source_span": {"start_char": 300, "end_char": 400}, "summary": "Common mistake: Misunderstanding the licensing terms.", "key_terms": ["licensing", "attribution"], "symbols": [], "concept_refs": ["C3"], "relations": [{"rel": "contrasts_with", "from": "C3", "to": "C4", "evidence": "misunderstanding licensing terms", "confidence": 0.9}], "seeds": {"mistake_and_fix": "Misunderstanding licensing terms \u2192 Read CC BY license carefully."}}, {"unit_id": "U5", "type": "definition", "source_span": {"start_char": 0, "end_char": 36}, "summary": "Evolution of computing", "key_terms": ["computing", "technology", "workplace"], "symbols": [], "concept_refs": ["C1"], "relations": [], "seeds": {"rule_or_core": "Computing evolution := changes in technology over time.", "conditions": [], "steps": [], "example": null, "mistake_and_fix": null}}, {"unit_id": "U6", "type": "claim_theorem", "source_span": {"start_char": 36, "end_char": 72}, "summary": "Computing has transformed workplaces.", "key_terms": ["computing", "workplace", "transformation"], "symbols": [], "concept_refs": ["C1"], "relations": [{"rel": "prerequisite", "from": "C1", "to": "C2", "evidence": "Computing has transformed workplaces.", "confidence": 1.0}], "seeds": {"rule_or_core": "If computing evolves, then workplace practices change.", "conditions": [], "steps": [], "example": null, "mistake_and_fix": null}}, {"unit_id": "U7", "type": "method_procedure", "source_span": {"start_char": 72, "end_char": 108}, "summary": "Key technologies in computing.", "key_terms": ["mobile devices", "digital imaging", "gaming"], "symbols": [], "concept_refs": ["C2"], "relations": [], "seeds": {"rule_or_core": "Key technologies := mobile devices, digital imaging, gaming.", "conditions": [], "steps": ["Identify key technologies", "Discuss their impact"], "example": null, "mistake_and_fix": null}}, {"unit_id": "U8", "type": "example", "source_span": {"start_char": 108, "end_char": 144}, "summary": "Raspberry Pi as a computing example.", "key_terms": ["Raspberry Pi", "computer", "technology"], "symbols": [], "concept_refs": ["C3"], "relations": [{"rel": "example_of", "from": "U4", "to": "C3", "evidence": "Raspberry Pi is a compact computer.", "confidence": 1.0}], "seeds": {"rule_or_core": "Raspberry Pi := compact computer for various tasks.", "conditions": [], "steps": [], "example": "Raspberry Pi powers robots.", "mistake_and_fix": null}}, {"unit_id": "U9", "type": "warning_common_mistake", "source_span": {"start_char": 144, "end_char": 180}, "summary": "Common misconceptions about computing.", "key_terms": ["misconception", "computing", "technology"], "symbols": [], "concept_refs": [], "relations": [], "seeds": {"mistake_and_fix": "Misconception: Technology replaces jobs. Correction: It enhances job performance."}}, {"unit_id": "U10", "type": "definition", "source_span": {"start_char": 0, "end_char": 36}, "summary": "Computer: programmable machine executing instructions.", "key_terms": ["computer", "programmable machine", "instructions"], "symbols": [], "concept_refs": ["C1"], "relations": [], "seeds": {"rule_or_core": "Computer := programmable machine", "conditions": [], "steps": [], "example": null, "mistake_and_fix": null}}, {"unit_id": "U11", "type": "definition", "source_span": {"start_char": 37, "end_char": 83}, "summary": "Mainframe: large computer for processing and storage.", "key_terms": ["mainframe", "processing speed", "data storage"], "symbols": [], "concept_refs": ["C2"], "relations": [{"rel": "defines", "from": "C2", "to": "C1", "evidence": "A very large computers called a mainframe", "confidence": 1.0}], "seeds": {"rule_or_core": "Mainframe := large computer", "conditions": [], "steps": [], "example": null, "mistake_and_fix": null}}, {"unit_id": "U12", "type": "method_procedure", "source_span": {"start_char": 84, "end_char": 138}, "summary": "Information processing cycle: input, processing, output, storage.", "key_terms": ["input", "processing", "output", "storage"], "symbols": [], "concept_refs": ["C3"], "relations": [], "seeds": {"rule_or_core": "Processing cycle := input -> processing -> output -> storage", "conditions": ["Valid for all computer systems"], "steps": ["1. Input data", "2. Process data", "3. Output results", "4. Store data"], "example": null, "mistake_and_fix": null}}, {"unit_id": "U13", "type": "definition", "source_span": {"start_char": 139, "end_char": 185}, "summary": "Network: connection of two or more computer systems.", "key_terms": ["network", "computer systems", "connection"], "symbols": [], "concept_refs": ["C4"], "relations": [], "seeds": {"rule_or_core": "Network := connection of computer systems", "conditions": [], "steps": [], "example": null, "mistake_and_fix": null}}, {"unit_id": "U14", "type": "claim_theorem", "source_span": {"start_char": 186, "end_char": 232}, "summary": "Types of networks: PAN, LAN, WAN.", "key_terms": ["PAN", "LAN", "WAN"], "symbols": [], "concept_refs": ["C5"], "relations": [{"rel": "prerequisite", "from": "C4", "to": "C5", "evidence": "These different types of networks are called", "confidence": 1.0}], "seeds": {"rule_or_core": "Types of networks := PAN, LAN, WAN", "conditions": [], "steps": [], "example": null, "mistake_and_fix": null}}, {"unit_id": "U15", "type": "warning_common_mistake", "source_span": {"start_char": 233, "end_char": 279}, "summary": "Phishing scams: misleading emails to steal information.", "key_terms": ["phishing", "scams", "identity theft"], "symbols": [], "concept_refs": ["C6"], "relations": [], "seeds": {"mistake_and_fix": "Phishing scams are common; avoid clicking unknown links.", "conditions": [], "steps": [], "example": null}}, {"unit_id": "U16", "type": "definition", "source_span": {"start_char": 280, "end_char": 326}, "summary": "Cloud computing: internet-based computing services.", "key_terms": ["cloud computing", "internet-based services"], "symbols": [], "concept_refs": ["C7"], "relations": [], "seeds": {"rule_or_core": "Cloud computing := internet-based services", "conditions": [], "steps": [], "example": null, "mistake_and_fix": null}}], "concepts": [{"concept_id": "C1", "name": "OpenStax", "aliases": [], "short_def": "Nonprofit educational initiative providing free textbooks.", "tags": ["concept", "initiative"], "prerequisites": [], "contrasts": [], "confidence": 1.0}, {"concept_id": "C2", "name": "Educational Access", "aliases": [], "short_def": "The ability to obtain educational resources.", "tags": ["concept"], "prerequisites": ["C1"], "contrasts": [], "confidence": 1.0}, {"concept_id": "C3", "name": "CC BY License", "aliases": [], "short_def": "Creative Commons license allowing redistribution with attribution.", "tags": ["concept", "license"], "prerequisites": [], "contrasts": [], "confidence": 1.0}, {"concept_id": "C4", "name": "Licensing Terms", "aliases": [], "short_def": "Rules governing the use of copyrighted material.", "tags": ["concept"], "prerequisites": [], "contrasts": ["C3"], "confidence": 0.8}, {"concept_id": "C5", "name": "Computing", "aliases": ["computer science", "technology"], "short_def": "The evolution and application of technology in various fields.", "tags": ["concept"], "prerequisites": [], "contrasts": [], "confidence": 1.0}, {"concept_id": "C6", "name": "Workplace Transformation", "aliases": ["workplace changes", "technology impact"], "short_def": "Changes in workplace practices due to technological advancements.", "tags": ["concept"], "prerequisites": ["C1"], "contrasts": [], "confidence": 1.0}, {"concept_id": "C7", "name": "Raspberry Pi", "aliases": ["Raspberry Pi 4"], "short_def": "A compact computer used for various applications.", "tags": ["concept"], "prerequisites": [], "contrasts": [], "confidence": 1.0}, {"concept_id": "C8", "name": "Computer", "aliases": [], "short_def": "Programmable machine executing instructions.", "tags": ["concept"], "prerequisites": [], "contrasts": [], "confidence": 1.0}, {"concept_id": "C9", "name": "Mainframe", "aliases": [], "short_def": "Large computer for processing and storage.", "tags": ["concept"], "prerequisites": ["C1"], "contrasts": [], "confidence": 1.0}, {"concept_id": "C10", "name": "Information Processing Cycle", "aliases": [], "short_def": "Sequence of input, processing, output, and storage.", "tags": ["concept"], "prerequisites": ["C1"], "contrasts": [], "confidence": 1.0}, {"concept_id": "C11", "name": "Network", "aliases": [], "short_def": "Connection of two or more computer systems.", "tags": ["concept"], "prerequisites": ["C1"], "contrasts": [], "confidence": 1.0}, {"concept_id": "C12", "name": "Types of Networks", "aliases": [], "short_def": "PAN, LAN, WAN.", "tags": ["concept"], "prerequisites": ["C4"], "contrasts": [], "confidence": 1.0}, {"concept_id": "C13", "name": "Phishing", "aliases": [], "short_def": "Scams to steal personal information.", "tags": ["concept", "pitfall"], "prerequisites": [], "contrasts": [], "confidence": 1.0}, {"concept_id": "C14", "name": "Cloud Computing", "aliases": [], "short_def": "Internet-based computing services.", "tags": ["concept"], "prerequisites": [], "contrasts": [], "confidence": 1.0}], "relations_graph": [{"rel_id": "R1", "type": "causes", "from": "C1", "to": "C2", "label": "improves", "evidence": "improve educational access", "confidence": 1.0}, {"rel_id": "R2", "type": "prerequisite", "from": "C2", "to": "C1", "label": "requires understanding", "evidence": "educational access depends on OpenStax", "confidence": 1.0}, {"rel_id": "R3", "type": "contrasts_with", "from": "C3", "to": "C4", "label": "misunderstanding", "evidence": "misunderstanding licensing terms", "confidence": 0.9}, {"rel_id": "R4", "type": "prerequisite", "from": "C1", "to": "C2", "label": "transforms", "evidence": "Computing has transformed workplaces.", "confidence": 1.0}, {"rel_id": "R5", "type": "example_of", "from": "U4", "to": "C3", "label": "example", "evidence": "Raspberry Pi is a compact computer.", "confidence": 1.0}, {"rel_id": "R6", "type": "defines", "from": "C2", "to": "C1", "label": "is a type of", "evidence": "A very large computers called a mainframe", "confidence": 1.0}, {"rel_id": "R7", "type": "prerequisite", "from": "C4", "to": "C5", "label": "includes", "evidence": "These different types of networks are called", "confidence": 1.0}], "skeleton_cards": [{"card_id": "S1", "topic": "OpenStax Overview", "blocks": [{"block_id": "B1", "title": "OpenStax Initiative", "anchors": ["OpenStax", "nonprofit", "textbooks"], "unit_refs": ["U1", "U2"], "concept_refs": ["C1", "C2"], "mini_links": [], "seed_pack": {"rule_plus_conditions": "OpenStax := nonprofit educational initiative", "procedure_steps": [], "one_strong_example": null, "one_common_mistake": null}}, {"block_id": "B2", "title": "Licensing and Customization", "anchors": ["CC BY license", "customization", "attribution"], "unit_refs": ["U3", "U4"], "concept_refs": ["C3", "C4"], "mini_links": [], "seed_pack": {"rule_plus_conditions": "Customization := allowed under CC BY license", "procedure_steps": ["distribute", "remix", "build upon"], "one_strong_example": null, "one_common_mistake": "Misunderstanding licensing terms \u2192 Read CC BY license carefully."}}]}, {"card_id": "S2", "topic": "Evolution of Computing", "blocks": [{"block_id": "B1", "title": "Overview", "anchors": ["Computing evolution", "Workplace transformation"], "unit_refs": ["U1", "U2"], "concept_refs": ["C1", "C2"], "mini_links": [], "seed_pack": {"rule_plus_conditions": "Computing evolution leads to workplace transformation.", "procedure_steps": [], "one_strong_example": null, "one_common_mistake": "Misconception: Technology replaces jobs."}}, {"block_id": "B2", "title": "Key Technologies", "anchors": ["Mobile devices", "Digital imaging", "Gaming"], "unit_refs": ["U3"], "concept_refs": ["C2"], "mini_links": [], "seed_pack": {"rule_plus_conditions": null, "procedure_steps": ["Identify key technologies", "Discuss their impact"], "one_strong_example": null, "one_common_mistake": null}}, {"block_id": "B3", "title": "Example", "anchors": ["Raspberry Pi"], "unit_refs": ["U4"], "concept_refs": ["C3"], "mini_links": [], "seed_pack": {"rule_plus_conditions": null, "procedure_steps": [], "one_strong_example": "Raspberry Pi powers robots.", "one_common_mistake": null}}]}, {"card_id": "S3", "topic": "Computer Hardware and Networks", "blocks": [{"block_id": "B1", "title": "What is a Computer?", "anchors": ["Computer", "Mainframe", "Software"], "unit_refs": ["U1", "U2"], "concept_refs": ["C1", "C2"], "mini_links": [], "seed_pack": {"rule_plus_conditions": "Computer := programmable machine", "procedure_steps": [], "one_strong_example": null, "one_common_mistake": null}}, {"block_id": "B2", "title": "Information Processing", "anchors": ["Input", "Processing", "Output", "Storage"], "unit_refs": ["U3"], "concept_refs": ["C3"], "mini_links": [], "seed_pack": {"rule_plus_conditions": "Processing cycle := input -> processing -> output -> storage", "procedure_steps": ["1. Input data", "2. Process data", "3. Output results", "4. Store data"], "one_strong_example": null, "one_common_mistake": null}}, {"block_id": "B3", "title": "Networks", "anchors": ["Network", "Types of Networks", "Phishing"], "unit_refs": ["U4", "U5", "U6"], "concept_refs": ["C4", "C5", "C6"], "mini_links": [], "seed_pack": {"rule_plus_conditions": "Network := connection of computer systems", "procedure_steps": [], "one_strong_example": null, "one_common_mistake": "Phishing scams are common; avoid clicking unknown links."}}, {"block_id": "B4", "title": "Cloud Computing", "anchors": ["Cloud Computing"], "unit_refs": ["U7"], "concept_refs": ["C7"], "mini_links": [], "seed_pack": {"rule_plus_conditions": "Cloud computing := internet-based services", "procedure_steps": [], "one_strong_example": null, "one_common_mistake": null}}]}], "quality_checks": {"shatalov_constraint_ok": true, "num_blocks_per_card": [2, 3, 4], "missing_prereqs_warnings": [], "knowledge_islands": [], "top_contrasts": ["Licensing terms vs CC BY License"], "coverage_estimate": {"major_concepts": 14, "major_methods": 2, "major_mistakes": 3}}};
    </script>

    <script>
        function app() {
            return {
                view: 'graph', // 'graph' or 'cards'
                searchQuery: '',
                selectedNode: null,
                highlightedCard: null,
                
                meta: DATA.meta,
                concepts: DATA.concepts,
                relations: DATA.relations_graph,
                skeleton_cards: DATA.skeleton_cards,
                
                network: null,
                nodes: new vis.DataSet([]),
                edges: new vis.DataSet([]),
                
                typeColors: {
                    'concept': 'bg-blue-100 text-blue-700',
                    'method': 'bg-green-100 text-green-700',
                    'mistake': 'bg-red-100 text-red-700',
                    'tool': 'bg-purple-100 text-purple-700',
                    'importance': 'bg-amber-100 text-amber-700'
                },

                init() {
                    this.initGraph();
                    this.processGraphData();
                },

                initGraph() {
                    const container = document.getElementById('mynetwork');
                    const options = {
                        nodes: {
                            shape: 'dot',
                            size: 20,
                            font: { size: 14, face: 'Inter, sans-serif' },
                            borderWidth: 2,
                            shadow: true
                        },
                        edges: {
                            width: 2,
                            smooth: { type: 'continuous' },
                            arrows: { to: { enabled: true, scaleFactor: 0.5 } },
                            color: { color: '#cbd5e1', highlight: '#3b82f6' }
                        },
                        physics: {
                            stabilization: false,
                            barnesHut: { gravitationalConstant: -3000, springConstant: 0.04, springLength: 150 }
                        },
                        interaction: { hover: true, tooltipDelay: 200 }
                    };
                    
                    this.network = new vis.Network(container, { nodes: this.nodes, edges: this.edges }, options);
                    
                    this.network.on("click", (params) => {
                        if (params.nodes.length > 0) {
                            this.selectNode(params.nodes[0]);
                        } else {
                            this.deselectNode();
                        }
                    });
                },

                processGraphData() {
                    // Nodes
                    const visNodes = this.concepts.map(c => {
                        const type = (c.tags && c.tags[0]) || 'concept';
                        let color = '#3b82f6'; // blue default
                        if (type === 'method') color = '#22c55e';
                        if (type === 'mistake' || type === 'pitfall') color = '#ef4444';
                        if (type === 'tool') color = '#a855f7';
                        
                        return {
                            id: c.concept_id,
                            label: c.name,
                            title: c.short_def || c.name,
                            color: { background: '#ffffff', border: color },
                            group: type
                        };
                    });
                    this.nodes.add(visNodes);

                    // Edges
                    const visEdges = this.relations.map(r => ({
                        from: r.from,
                        to: r.to,
                        label: r.type,
                        font: { align: 'middle', size: 10, color: '#94a3b8' },
                        dashes: r.type === 'contrasts_with'
                    }));
                    this.edges.add(visEdges);
                },

                selectNode(nodeId) {
                    const concept = this.concepts.find(c => c.concept_id === nodeId);
                    if (!concept) return;

                    // Find related cards
                    const relatedCards = this.skeleton_cards
                        .filter(card => card.blocks.some(b => b.concept_refs.includes(nodeId)))
                        .map(c => c.card_id);

                    // Find relations
                    const relations = this.relations.filter(r => r.from === nodeId || r.to === nodeId).map(r => {
                        const targetId = r.from === nodeId ? r.to : r.from;
                        const targetConcept = this.concepts.find(c => c.concept_id === targetId);
                        return {
                            type: r.type,
                            targetId: targetId,
                            targetLabel: targetConcept ? targetConcept.name : targetId,
                            direction: r.from === nodeId ? 'out' : 'in'
                        };
                    });

                    this.selectedNode = {
                        id: concept.concept_id,
                        label: concept.name,
                        def: concept.short_def,
                        type: (concept.tags && concept.tags[0]) || 'concept',
                        cards: relatedCards,
                        relations: relations
                    };
                },

                deselectNode() {
                    this.selectedNode = null;
                    this.network.unselectAll();
                },

                focusNode(nodeId) {
                    this.network.selectNodes([nodeId]);
                    this.network.focus(nodeId, { scale: 1.2, animation: true });
                    this.selectNode(nodeId);
                },

                getCardTitle(cardId) {
                    const card = this.skeleton_cards.find(c => c.card_id === cardId);
                    return card ? card.topic : cardId;
                },

                selectCard(cardId) {
                    this.highlightedCard = cardId;
                    setTimeout(() => {
                        const el = document.getElementById('card-' + cardId);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                },

                filterGraph() {
                    const q = this.searchQuery.toLowerCase();
                    if (!q) {
                        this.nodes.update(this.nodes.get().map(n => ({ hidden: false })));
                        return;
                    }
                    
                    const matches = this.nodes.get().filter(n => n.label.toLowerCase().includes(q));
                    const matchIds = matches.map(n => n.id);
                    
                    this.nodes.update(this.nodes.get().map(n => ({
                        hidden: !matchIds.includes(n.id)
                    })));
                    
                    if (matchIds.length > 0) {
                        this.network.fit({ nodes: matchIds, animation: true });
                    }
                }
            }
        }
    </script>
</body>
</html>
